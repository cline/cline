name: Release Publisher

on:
    release:
        types: [published]

jobs:
    publish:
    runs-on: ubuntu-latest
    steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup Node.js
          uses: actions/setup-node@v4
          with:
              node-version: "20.15.1"
              cache: "npm"

        - name: Install dependencies
          run: |
              npm ci
              cd webview-ui && npm ci
              cd ..

        - name: Install vsce
          run: npm install -g @vscode/vsce

        - name: Build VSIX
          run: vsce package

        - name: Publish to Marketplace
          run: vsce publish -p ${{ secrets.VSCE_PAT }}
          env:
              VSCE_PAT: ${{ secrets.VSCE_PAT }}
