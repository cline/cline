# 使用 Cline 從零開始構建自定義 MCP 伺服器：綜合指南

本指南提供了從零開始構建自定義 MCP（模型上下文協議）伺服器的全面步驟說明，利用 Cline 的強大 AI 能力。將使用構建「GitHub 助手伺服器」作為示例來說明此過程。

## 了解 MCP 以及 Cline 在構建伺服器中的角色

### 什麼是 MCP？

模型上下文協議（MCP）作為大型語言模型（如 Claude）與外部工具和數據之間的橋樑。MCP 由兩個關鍵組成部分組成：

-   **MCP 主機：** 這些是與大型語言模型（如 Cline、Claude Desktop 等）整合的應用程式。
-   **MCP 伺服器：** 這些是專門設計用來通過 MCP 向大型語言模型公開數據或特定功能的小型程式。

當您擁有一個符合 MCP 的聊天界面（如 Claude Desktop）時，這種設置非常有用，它可以利用這些伺服器來訪問信息和執行操作。

### 為什麼使用 Cline 來創建 MCP 伺服器？

Cline 通過利用其 AI 能力簡化了構建和整合 MCP 伺服器的過程：

-   **理解自然語言指令：** 您可以以自然的方式與 Cline 交流，使開發過程直觀且用戶友好。
-   **克隆倉庫：** Cline 可以直接從 GitHub 克隆現有的 MCP 伺服器倉庫，簡化了使用預建伺服器的過程。
-   **構建伺服器：** 一旦必要的代碼就位，Cline 可以執行如 `npm run build` 的命令來編譯並準備伺服器以供使用。
-   **處理配置：** Cline 管理 MCP 伺服器所需的配置文件，包括將新伺服器添加到 `cline_mcp_settings.json` 文件中。
-   **協助故障排除：** 如果在開發或測試期間出現錯誤，Cline 可以幫助識別原因並提出解決方案，使調試更容易。

## 使用 Cline 構建 GitHub 助手伺服器：逐步指南

本節展示如何使用 Cline 創建 GitHub 助手伺服器。該伺服器將能夠與 GitHub 數據互動並執行有用的操作：

### 1. 定義目標和初始要求

首先，您需要向 Cline 清楚地傳達您的伺服器的目的和功能：

-   **伺服器目標：** 告知 Cline 您想要構建「GitHub 助手伺服器」。指定該伺服器將與 GitHub 數據互動，並可能提到您感興趣的數據類型，如問題、拉取請求和用戶配置文件。
-   **訪問要求：** 讓 Cline 知道您需要訪問 GitHub API。解釋這可能需要個人訪問令牌（GITHUB_TOKEN）進行身份驗證。
-   **數據具體性（可選）：** 您可以選擇性地告訴 Cline 您想要從 GitHub 提取的特定數據字段，但這也可以在您定義伺服器的工具時後續確定。

### 2. Cline 啟動項目設置

根據您的指示，Cline 開始項目設置過程：
-   **專案結構：** Cline 可能會要求您為伺服器命名。接著，它會使用 MCP 的 `create-server` 工具來生成您的 GitHub 助手伺服器的基本專案結構。這通常涉及創建一個包含基本檔案的新目錄，例如 `package.json`、`tsconfig.json`，以及用於您的 TypeScript 程式碼的 `src` 資料夾。
-   **程式碼生成：** Cline 為您的伺服器生成起始程式碼，包括：
    -   **檔案處理工具：** 用於讀取和寫入檔案的函數，常用於存儲資料或日誌。
    -   **GitHub API 客戶端：** 與 GitHub API 互動的程式碼，通常使用像 `@octokit/graphql` 這樣的庫。Cline 可能會詢問您的 GitHub 用戶名或您想要使用的儲存庫。
    -   **核心伺服器邏輯：** 處理來自 Cline 的請求並將其路由到適當函數的基本框架，由 MCP 定義。
-   **依賴管理：** Cline 分析程式碼並識別必要的依賴項，將其添加到 `package.json` 檔案中。例如，與 GitHub API 互動可能需要 `@octokit/graphql`、`graphql`、`axios` 或類似的套件。
-   **依賴安裝：** Cline 執行 `npm install` 來下載並安裝 `package.json` 中列出的依賴項，確保您的伺服器擁有所有必要的庫以正確運作。
-   **路徑更正：** 在開發過程中，您可能會移動檔案或目錄。Cline 智能地識別這些變化並自動更新程式碼中的檔案路徑以保持一致性。
-   **配置：** Cline 將修改 `cline_mcp_settings.json` 檔案以添加您的新 GitHub 助手伺服器。這將包括：
    -   **伺服器啟動命令：** Cline 將添加適當的命令來啟動您的伺服器（例如 `npm run start` 或類似的命令）。
    -   **環境變數：** Cline 將添加所需的 `GITHUB_TOKEN` 變數。Cline 可能會詢問您的 GitHub 個人訪問令牌，或者它可能會指導您將其安全地存儲在單獨的環境檔案中。
-   **進度記錄：** 在整個過程中，Cline 會保持 "記憶庫" 檔案的最新狀態。這些檔案記錄專案的進展，強調已完成的任務、進行中的任務和待處理的任務。

### 3. 測試 GitHub 助手伺服器

一旦 Cline 完成了設置和配置，您就可以測試伺服器的功能：
-   **使用伺服器工具：** Cline 將在您的伺服器中創建各種「工具」，代表行動或資料檢索功能。為了測試，您會指示 Cline 使用特定工具。以下是與 GitHub 相關的例子：
    -   **`get_issues`：** 為了測試檢索議題，您可以對 Cline 說：「Cline，使用 GitHub Assistant Server 的 `get_issues` 工具，顯示來自 'cline/cline' 倉庫的開放議題。」Cline 接著會執行此工具並向您展示結果。
    -   **`get_pull_requests`：** 為了測試拉取請求的檢索，您可以要求 Cline「使用 `get_pull_requests` 工具，顯示來自 'facebook/react' 倉庫過去一個月的合併拉取請求。」Cline 會執行此工具，使用您的 GITHUB_TOKEN 訪問 GitHub API，並顯示所請求的數據。
-   **提供必要資訊：** Cline 可能會提示您提供執行工具所需的額外資訊，例如倉庫名稱、特定日期範圍或其他過濾條件。
-   **Cline 執行工具：** Cline 處理與 GitHub API 的通訊，檢索所請求的數據，並以清晰易懂的格式呈現。

### 4. 改進伺服器並添加更多功能

開發通常是迭代的。當您使用您的 GitHub Assistant Server 時，您會發現新的功能要添加，或改進現有功能的方法。Cline 可以協助這個持續的過程：

-   **與 Cline 討論：** 與 Cline 討論您對新工具或改進的想法。例如，您可能想要一個 `create_issue` 或 `get_user_profile` 的工具。與 Cline 討論這些工具所需的輸入和輸出。
-   **代碼改進：** Cline 可以幫助您為新功能編寫必要的代碼。Cline 可以生成代碼片段，建議最佳實踐，並幫助您調試任何出現的問題。
-   **測試新功能：** 在添加新工具或功能後，您會再次使用 Cline 進行測試，確保它們按預期工作並與伺服器的其他部分良好整合。
-   **與其他工具整合：** 您可能想要將您的 GitHub Assistant 伺服器與其他工具整合。例如，在「github-cline-mcp」源中，Cline 協助將伺服器與 Notion 整合，以創建一個動態儀表板來追蹤 GitHub 活動。

通過遵循這些步驟，您可以使用 Cline 從頭開始創建一個自定義的 MCP 伺服器，利用其強大的 AI 能力來簡化整個過程。Cline 不僅協助構建伺服器的技術方面，還幫助您思考設計、功能和潛在的整合。