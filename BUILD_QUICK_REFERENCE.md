# BCline Build Quick Reference

**Last Updated:** December 3, 2025

---

## ðŸš€ Quick Build Commands

### Full Clean Build (Recommended)
```bash
cd /c/Users/bob43/Downloads/Bcline
./build-bcline.sh
```

### Manual Build (Step by Step)
```bash
# 1. Clean
rm -rf node_modules webview-ui/node_modules dist webview-ui/dist

# 2. Install
npm install --ignore-scripts
cd node_modules/grpc-tools && npm install && cd ../..
cd webview-ui && npm install --legacy-peer-deps && cd ..

# 3. Build
npm run protos
npx tsc --noEmit
npm run lint
cd webview-ui && npm run build && cd ..
node esbuild.mjs --production
npx @vscode/vsce package --no-dependencies
```

### Partial Rebuild (After Code Changes)
```bash
# Skip clean, just rebuild extension
node esbuild.mjs --production
npx @vscode/vsce package --no-dependencies
```

---

## ðŸ“¦ Critical Package Versions

| Package | Version | Location |
|---------|---------|----------|
| Node.js | v20.11.1+ | System |
| npm | v10.2.4+ | System |
| TypeScript | ^5.4.5 | Root & Webview |
| Vite | ^5.4.11 | Webview only |

**âš ï¸ NEVER use Vite 7.x with Node 20.11.1 - it will fail!**

---

## ðŸ”§ Common Issues - Fast Solutions

### "vite: command not found"
```bash
cd webview-ui
nano package.json  # Change vite to "^5.4.11"
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
cd ..
```

### "Cannot find module 'grpc-tools'"
```bash
cd node_modules/grpc-tools
npm install
cd ../..
```

### "husky: command not found"
```bash
# Ignore - just use --ignore-scripts:
npm install --ignore-scripts
```

### TypeScript build crash
```bash
# Check webview tsconfig.app.json has:
# "incremental": true  (YES)
# "composite": true    (NO - remove if present)
```

### TypeScript version mismatch
```bash
# Both must be same:
grep '"typescript":' package.json
grep '"typescript":' webview-ui/package.json
# If different, edit webview-ui/package.json to match root
```

---

## âœ… Verification Checklist

After build, verify:
```bash
# 1. VSIX exists and is ~30-35MB
ls -lh bcline-3.39.2-complete.vsix

# 2. Extension bundle exists and is ~18MB
ls -lh dist/extension.js

# 3. Webview built
ls webview-ui/dist/index.html

# 4. VSIX file count (should be 3000-4000)
unzip -l bcline-3.39.2-complete.vsix | wc -l

# 5. Test extraction
unzip -t bcline-3.39.2-complete.vsix | grep -i error
# Should return nothing
```

---

## ðŸ“ Key File Paths

```
BCline/
â”œâ”€â”€ node_modules/                        # Root dependencies
â”‚   â””â”€â”€ grpc-tools/
â”‚       â””â”€â”€ bin/
â”‚           â”œâ”€â”€ protoc.exe               # âœ… Must exist
â”‚           â””â”€â”€ grpc_node_plugin.exe     # âœ… Must exist
â”œâ”€â”€ webview-ui/
â”‚   â”œâ”€â”€ node_modules/                    # Webview dependencies
â”‚   â”‚   â””â”€â”€ vite/
â”‚   â”‚       â””â”€â”€ bin/
â”‚   â”‚           â””â”€â”€ vite.js              # âœ… Must exist (if Vite 5.x)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ grpc-client.ts           # âœ… Generated by protos
â”‚   â””â”€â”€ dist/                            # Webview build output
â”‚       â”œâ”€â”€ index.html                   # âœ… Must exist after build
â”‚       â””â”€â”€ assets/                      # âœ… Must exist after build
â”œâ”€â”€ src/
â”‚   â””â”€â”€ generated/
â”‚       â””â”€â”€ hosts/
â”‚           â””â”€â”€ vscode/
â”‚               â””â”€â”€ hostbridge-grpc-service-config.ts  # âœ… Generated
â”œâ”€â”€ dist/
â”‚   â””â”€â”€ extension.js                     # âœ… Main bundle (~18MB)
â””â”€â”€ bcline-3.39.2-complete.vsix         # âœ… Final output (~30-35MB)
```

---

## ðŸŽ¯ Build Time Reference

| Operation | Time |
|-----------|------|
| Full clean build | ~8-10 min |
| Incremental rebuild | ~2-3 min |
| Extension only | ~30 sec |
| Webview only | ~1 min |
| VSIX package | ~15 sec |

---

## ðŸ” Debug Commands

```bash
# Check versions
node --version                           # Should be v20.11.1+
npm --version                            # Should be v10.2.4+
npx tsc --version                        # Should be 5.4.5
cd webview-ui && npx vite --version      # Should be 5.4.x

# Check installation status
npm ls typescript                        # Root
cd webview-ui && npm ls typescript       # Webview
cd webview-ui && npm ls vite            # Should show tree, not (empty)

# Check generated files
ls -la src/generated/hosts/vscode/
ls -la webview-ui/src/services/

# Check build outputs
ls -lh dist/extension.js
ls -lh webview-ui/dist/
```

---

## ðŸ“ž Troubleshooting Flowchart

```
Build Failed?
    â”œâ”€ Dependency issue?
    â”‚   â”œâ”€ "vite not found" â†’ Check Node version & Vite version
    â”‚   â”œâ”€ "grpc-tools" â†’ Rebuild native binaries
    â”‚   â””â”€ "husky" â†’ Use --ignore-scripts
    â”‚
    â”œâ”€ Type check failed?
    â”‚   â”œâ”€ Version mismatch â†’ Align TypeScript versions
    â”‚   â”œâ”€ Build mode crash â†’ Remove "composite": true
    â”‚   â””â”€ Missing types â†’ Check proto generation
    â”‚
    â”œâ”€ Build failed?
    â”‚   â”œâ”€ Webview â†’ Check vite installation
    â”‚   â”œâ”€ Extension â†’ Check proto files exist
    â”‚   â””â”€ VSIX â†’ Check dist/ and webview-ui/dist/ exist
    â”‚
    â””â”€ Unknown error?
        â””â”€ See CORRECT_BUILD_PROCEDURE.md for full details
```

---

## ðŸ†˜ Emergency Recovery

If everything is broken:
```bash
cd /c/Users/bob43/Downloads/Bcline

# 1. Stash changes
git stash

# 2. Reset to known good state
git checkout bcline-3.39.2-complete
git reset --hard

# 3. Clean everything
rm -rf node_modules webview-ui/node_modules
rm -rf dist webview-ui/dist out
rm -f package-lock.json webview-ui/package-lock.json

# 4. Verify package.json versions
cat webview-ui/package.json | grep '"vite":'
# Should show: "vite": "^5.4.11"

# 5. Run automated build
./build-bcline.sh
```

---

## ðŸ“š Full Documentation

- **[BUILD_PROCESS_ANALYSIS.md](./BUILD_PROCESS_ANALYSIS.md)** - Detailed error analysis
- **[CORRECT_BUILD_PROCEDURE.md](./CORRECT_BUILD_PROCEDURE.md)** - Step-by-step procedure
- **[COMPLETE_CHANGES_LIST.md](./COMPLETE_CHANGES_LIST.md)** - All custom features

---

## ðŸ’¡ Pro Tips

1. **Always check versions first** before starting build
2. **Use automated script** (`build-bcline.sh`) for consistent builds
3. **Clean build** if you haven't built in >1 week
4. **Incremental build** for quick iteration during development
5. **Verify VSIX** before distributing (test install on clean VSCode)

---

**Remember:** The key to successful builds is getting the versions right!

- âœ… TypeScript: ^5.4.5 (both root and webview)
- âœ… Vite: ^5.4.11 (webview only)
- âœ… Node: v20.11.1+ (system)

---

**Quick Commands Cheatsheet:**

```bash
# Start here:
./build-bcline.sh

# Or if script fails:
npm install --ignore-scripts && \
cd node_modules/grpc-tools && npm install && cd ../.. && \
cd webview-ui && npm install --legacy-peer-deps && cd .. && \
npm run protos && \
npx tsc --noEmit && \
npm run lint && \
cd webview-ui && npm run build && cd .. && \
node esbuild.mjs --production && \
npx @vscode/vsce package --no-dependencies
```

---

**Last Updated:** December 3, 2025
