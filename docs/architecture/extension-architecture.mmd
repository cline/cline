graph TB
    subgraph VSCode Extension Host
        subgraph Core Extension
            ExtensionEntry[Extension Entry<br/>src/extension.ts]
            WebviewProvider[WebviewProvider<br/>src/core/webview/index.ts]
            Controller[Controller<br/>src/core/controller/index.ts]
            TaskClass[Task Class<br/>src/core/task/index.ts]
            Storage[Storage<br/>src/core/storage/state.ts]
            GlobalState[VSCode Global State]
            SecretsStorage[VSCode Secrets Storage]
        end

        subgraph Webview UI
            WebviewApp[React App<br/>webview-ui/src/App.tsx]
            ExtStateContext[ExtensionStateContext<br/>webview-ui/src/context/ExtensionStateContext.tsx]
            ReactComponents[React Components]
        end

        subgraph Storage
            TaskStorage[Task Storage<br/>Per-Task Files & History]
            CheckpointSystem[Git-based Checkpoints]
        end
    end

    %% Core Extension Data Flow
    ExtensionEntry --> WebviewProvider
    WebviewProvider --> Controller
    Controller --> TaskClass
    Controller --> Storage
    Storage --> GlobalState
    Storage --> SecretsStorage
    TaskClass --> TaskStorage
    TaskClass --> CheckpointSystem

    %% Webview Data Flow
    WebviewApp --> ExtStateContext
    ExtStateContext --> ReactComponents

    %% Bidirectional Communication
    WebviewProvider <-->|postMessage| ExtStateContext
    Controller <--> WebviewProvider

    style GlobalState fill:#ff0066,stroke:#333,stroke-width:2px,color:#ffffff
    style SecretsStorage fill:#ff0066,stroke:#333,stroke-width:2px,color:#ffffff
    style ExtStateContext fill:#0066ff,stroke:#333,stroke-width:2px,color:#ffffff
    style WebviewProvider fill:#00cc66,stroke:#333,stroke-width:2px,color:#ffffff
    style Controller fill:#ff9900,stroke:#333,stroke-width:2px,color:#ffffff
