#!/usr/bin/env node
/**
 * Hook Template Script
 *
 * This is a template for creating new hook test fixtures.
 * Copy this file and customize the logic for your specific test case.
 *
 * Available input data (depends on hook type):
 * - Common: clineVersion, hookName, timestamp, taskId, workspaceRoots, userId
 * - PreToolUse: preToolUse.toolName, preToolUse.parameters
 * - PostToolUse: postToolUse.toolName, postToolUse.parameters, postToolUse.result, postToolUse.success, postToolUse.executionTimeMs
 * - UserPromptSubmit: userPromptSubmit.prompt, userPromptSubmit.attachments
 * - TaskStart/Resume/Cancel/Complete: taskX.taskMetadata
 * - PreCompact: preCompact.contextSize, preCompact.messagesToCompact, preCompact.compactionStrategy
 */

try {
  // Parse input from stdin
  const input = JSON.parse(require('fs').readFileSync(0, 'utf-8'));

  // Common metadata (available in all hook types)
  const { hookName, timestamp, taskId, workspaceRoots, userId, clineVersion } = input;

  // Hook-specific data (only one of these will be present)
  const { preToolUse, postToolUse, userPromptSubmit, taskStart, taskResume, taskCancel, taskComplete, preCompact } = input;

  // Initialize output
  let cancel = false;
  let contextModification = "";
  let errorMessage = "";

  // === CUSTOMIZE THIS SECTION ===
  
  // Example: Success case
  contextModification = "TEMPLATE: Hook executed successfully";

  // Example: PreToolUse - block specific tools
  if (preToolUse) {
    const { toolName, parameters } = preToolUse;
    // Uncomment to block a specific tool:
    // if (toolName === "execute_command") {
    //   cancel = true;
    //   errorMessage = "Tool blocked by hook";
    // }
  }

  // Example: PostToolUse - track results
  if (postToolUse) {
    const { toolName, success, executionTimeMs } = postToolUse;
    contextModification = `POST_TOOL: ${toolName} completed (success: ${success})`;
  }

  // === END CUSTOMIZATION ===

  // Output result (must be valid JSON)
  console.log(JSON.stringify({
    cancel,
    contextModification,
    errorMessage
  }));

} catch (error) {
  // Error handling - output valid JSON even on error
  console.log(JSON.stringify({
    cancel: true,
    contextModification: "",
    errorMessage: `HOOK_ERROR: ${error instanceof Error ? error.message : String(error)}`
  }));
}
